<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>强密码生成器</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --border: #d9dfe8;
        }

        body {
            font-family: 'Inter', -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            padding: 30px 20px;
            margin: 0;
            font-size: 16px; 
        }

        .container {
            background: var(--card);
            padding: 30px 45px 45px 45px;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.06);
            width: 100%;
            max-width: 650px;
        }

        h2 { 
            text-align: center; 
            font-size: 28px;
            margin-top: 0;
            margin-bottom: 60px;
            color: #0f172a;
            letter-spacing: -1px;
        }

        .form-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
        }

        .form-row-compact {
            display: flex;
            gap: 20px;
            margin-bottom: 18px;
            padding: 0px 8px;
        }

        .input-group {
            display: flex;
            align-items: center;
            flex: 1;
            justify-content: normal;
        }

        .input-group label {
            font-weight: 600;
            font-size: 17px;
            white-space: nowrap;
            margin-right: 10px;
        }
        
        input[type="number"], input[type="text"] {
            padding: 5px 14px;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-size: 24px; 
            outline: none;
            width: 70px;
            text-align: center;
        }

        #countInput{
            text-align: left;
        }
        #lenInput{
            text-align: left;
        }

        .settings-list {
            margin: 20px 0;
            border-top: 1.5px solid var(--border);
            padding-top: 10px;
        }

        .setting-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .setting-item:last-child { border-bottom: none; }

        .setting-item input[type="checkbox"], .setting-item input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
            cursor: pointer;
            margin-right: 10px;
        }

        .setting-item label {
            font-size: 16px;
            cursor: pointer;
            user-select: none;
            margin-right: 15px;
        }

        .radio-group {
            display: flex;
            align-items: center;
            margin-right: 15px;
            font-size: 14px;
            color: #475569;
        }

        .custom-input {
            width: 280px !important;
            text-align: center;
            padding: 6px !important;
        }

        .fixed-text-input {
            width: 180px !important;
            border: 1.5px solid var(--border);
            font-weight: bold;
            font-size: 12px; 
            height: 16px;
            padding:10px 14px !important;
        }

        .btn-gen {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 28px; 
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .btn-gen:hover {
            background: var(--primary-dark);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        /* 统一按钮样式逻辑：复制全部 和 复制单个 */
        .btn-copy-all, .btn-copy {
            padding: 10px;
            background: #f1f5f9;
            color: var(--primary);
            border: 1.5px solid var(--primary);
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-copy-all {
            width: 100%;
            font-size: 18px;
            margin-bottom: 20px;
        }

        /* 统一 Hover 效果 */
        .btn-copy-all:hover, .btn-copy:hover {
            background: var(--primary);
            color: white;
        }

        #resultArea {
            margin-top: 30px;
        }

        .pwd-card {
            background: #b8e9dc;
            border: 1.5px solid #f1f5f9;
            margin-bottom: 15px;
            border-radius: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            overflow: hidden;
            padding: 6px; /* 增加内边距让内部按钮有间距感 */
        }

        .pwd-val {
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            font-size: 34px; 
            color: var(--primary-dark);
            font-weight: 700;
            word-break: break-all;
            padding: 0 10px;
        }

        /* 覆盖之前的样式，确保宽度和对齐 */
        .btn-copy {
            font-size: 25px;
            white-space: nowrap;
            min-width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

    </style>
</head>
<body>

<div class="container">
    <h2>强密码生成器</h2>

    <div class="form-row-compact">
        <div class="input-group">
            <label>生成数量</label>
            <input type="number" id="countInput" value="1" min="1" max="500">
        </div>
        <div class="input-group">
            <label>密码长度</label>
            <input type="number" id="lenInput" value="12" min="4" max="128">
        </div>
    </div>

    <div class="settings-list">
        <div class="setting-item" style="border-radius: 10px; ">
            <input type="checkbox" id="useFixed">
            <label for="useFixed">包含自定义字符</label>
            
            <div class="radio-group">
                <input type="radio" id="posHead" name="pos" value="head">
                <label for="posHead">开头包含</label>
                <input type="radio" id="posTail" name="pos" value="tail" checked>
                <label for="posTail">结尾包含</label>
            </div>
            
            <input type="text" id="fixedText" class="fixed-text-input" value="" placeholder="">
        </div>

        <div class="setting-item">
            <input type="checkbox" id="up" checked>
            <label for="up">包含大写字母 (A-Z)</label>
        </div>
        <div class="setting-item">
            <input type="checkbox" id="lo" checked>
            <label for="lo">包含小写字母 (a-z)</label>
        </div>
        <div class="setting-item">
            <input type="checkbox" id="nu" checked>
            <label for="nu">包含数字 (0-9)</label>
        </div>
        <div class="setting-item">
            <input type="checkbox" id="sp" checked>
            <label for="sp">包含特殊字符</label>
            <input type="text" id="spChars" class="custom-input" value="!@#$%&*">
        </div>
        
        <div class="setting-item">
            <input type="checkbox" id="noSim" checked>
            <label for="noSim"><span style="font-weight: 550;">不包含 </span><span>相似字符</span></label>
            <input type="text" id="simChars" class="custom-input" value="Oo0lI1">
        </div>
    </div>

    <button class="btn-gen" onclick="generate()">点击生成</button>

    <div id="resultArea"></div>
</div>

<script>
    let currentPasswords = [];

    function syncHash() {
        const hash = window.location.hash.substring(1);
        const fixedInput = document.getElementById('fixedText');
        const fixedCheck = document.getElementById('useFixed');
        
        if (hash) {
            fixedInput.value = decodeURIComponent(hash);
            fixedCheck.checked = true;
        }
    }

    window.addEventListener('load', syncHash);
    window.addEventListener('hashchange', syncHash);

    function generate() {
        let count = parseInt(document.getElementById('countInput').value) || 1;
        const totalLen = parseInt(document.getElementById('lenInput').value);
        
        const useFixed = document.getElementById('useFixed').checked;
        const fixedText = document.getElementById('fixedText').value;
        const isHead = document.getElementById('posHead').checked;
        
        const excludeSimilar = document.getElementById('noSim').checked;
        const simChars = document.getElementById('simChars').value;

        function filterSet(set) {
            if (!excludeSimilar || !simChars) return set;
            let filtered = "";
            for(let char of set) {
                if (!simChars.includes(char)) filtered += char;
            }
            return filtered;
        }

        const configs = [
            { id: 'up', set: "ABCDEFGHIJKLMNOPQRSTUVWXYZ" },
            { id: 'lo', set: "abcdefghijklmnopqrstuvwxyz" },
            { id: 'nu', set: "0123456789" },
            { id: 'sp', set: document.getElementById('spChars').value }
        ];

        let activeSets = [];
        configs.forEach(c => {
            if (document.getElementById(c.id).checked) {
                let s = filterSet(c.set);
                if (s.length > 0) activeSets.push(s);
            }
        });

        let requiredLen = activeSets.length;
        if (useFixed && fixedText) {
            requiredLen += fixedText.length;
        }

        if (requiredLen > totalLen) {
            alert(`当前设置下，密码总长度不足！需要至少 ${requiredLen} 位。`);
            return;
        }

        const resArea = document.getElementById('resultArea');
        resArea.innerHTML = "";
        currentPasswords = [];

        for (let i = 0; i < count; i++) {
            let pwdArr = [];
            activeSets.forEach(s => {
                pwdArr.push(s.charAt(Math.floor(Math.random() * s.length)));
            });

            const randomTargetLen = (useFixed && fixedText) ? (totalLen - fixedText.length) : totalLen;
            const fullPool = activeSets.join("");
            
            while (pwdArr.length < randomTargetLen) {
                pwdArr.push(fullPool.charAt(Math.floor(Math.random() * fullPool.length)));
            }
            
            for (let k = pwdArr.length - 1; k > 0; k--) {
                const j = Math.floor(Math.random() * (k + 1));
                [pwdArr[k], pwdArr[j]] = [pwdArr[j], pwdArr[k]];
            }

            let final = pwdArr.join("");
            if (useFixed && fixedText) {
                final = isHead ? (fixedText + final) : (final + fixedText);
            }

            currentPasswords.push(final);

            const div = document.createElement('div');
            div.className = 'pwd-card';
            div.innerHTML = `<span class="pwd-val">${final}</span><button class="btn-copy" onclick="copy(this,'${final}')">复制</button>`;
            resArea.appendChild(div);
        }

        if (count > 1) {
            const copyAllBtn = document.createElement('button');
            copyAllBtn.className = 'btn-copy-all';
            copyAllBtn.innerText = '点击：复制全部密码';
            copyAllBtn.onclick = function() { copyAll(this); };
            resArea.insertBefore(copyAllBtn, resArea.firstChild);
        }
    }

    function copy(btn, txt) {
        navigator.clipboard.writeText(txt).then(() => {
            const oldText = btn.innerText;
            btn.innerText = "已复制";
            btn.style.background = "#22c55e";
            btn.style.color = "white";
            btn.style.borderColor = "#22c55e";
            setTimeout(() => {
                btn.innerText = oldText;
                btn.style.background = "";
                btn.style.color = "";
                btn.style.borderColor = "";
            }, 1000);
        });
    }

    function copyAll(btn) {
        const allTxt = currentPasswords.join('\n');
        navigator.clipboard.writeText(allTxt).then(() => {
            const oldText = btn.innerText;
            btn.innerText = "全部密码已复制到剪贴板";
            btn.style.background = "#22c55e";
            btn.style.color = "white";
            btn.style.borderColor = "#22c55e";
            setTimeout(() => {
                btn.innerText = oldText;
                btn.style.background = "";
                btn.style.color = "";
                btn.style.borderColor = "";
            }, 2000);
        });
    }
</script>

</body>
</html>
